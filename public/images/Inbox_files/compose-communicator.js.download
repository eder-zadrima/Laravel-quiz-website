(window.webpackJsonp=window.webpackJsonp||[]).push([["compose-communicator"],{GOp0:function(e,t,n){"use strict";n.d(t,"a",function(){return a});n.d(t,"c",function(){return c});n.d(t,"b",function(){return s});var a="COMPOSITION",c="FORWARD",s="DIRECT_REPLY"},Gdeq:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var a=n("+KT1"),c=n.n(a)()(function(e,t,n){return t+"_"+e+"_"+n})},XeYr:function(e,t,n){"use strict";n.r(t);var a=n("QgEn"),c=n("fzi9"),s=n("VfuR"),o=n.n(s),i=n("19qb"),r=n("os+u"),l=n.n(r),u=n("Ktcs"),d=n("mKxs"),b=n("KXN9"),m=n("0IK8"),j=n("RM1X"),O=n("LB2W"),p=n("/iZH"),f=n("6Djj"),g=function(e){var t=e.conversationsMessageId,n=e.inReplyToDisposition,a=void 0===n?"FORWARD":n;return f.a.get("/conversations-email/v1/app-messages/"+t+"/formatted-reply-body?inReplyToDisposition="+a,{headers:{Accept:"text/html"}})},h=n("if8Z"),y=n("BEAo"),A=n("dIqZ"),E=n("OJmF"),I=n("QYOI"),C=n("tyhE"),S=n("FolP"),v=n("Gdeq"),R=n("4mrg"),x=n("wLkx"),M=n("eoCu"),N=n("GOp0"),F=n("M+NM"),T=n("R3B1"),w=n("fCtp"),q=C.a.EMAIL,L=function(e){var t=e.connectedAccounts,n=e.message,a=e.isReply,c=e.attachments,s=a?N.b:N.c,o=Object(M.a)(n),i=Object(v.a)(q,s,o),r=Object(F.a)({replyingToMessage:n,connectedAccounts:t}),l=a?Object(T.a)(r,n):{bcc:Object(I.List)(),cc:Object(I.List)(),to:Object(I.List)()},u=l.bcc,d=l.cc,b=l.to;return Object(R.a)({replyId:i,metadata:Object(S.a)({bcc:u,cc:d,to:b,from:r,subject:a?Object(w.a)({message:n}):Object(x.a)(n),inReplyToMessageId:Object(m.f)(n)}),attachments:c})},P=n("pYy/"),V=n("1AW5"),k=n("snvP"),X=n("3kdm"),D=n("hogP"),K=n("YVsz"),z=n("wE3D"),B=n("XILT"),G=function(e){var t=e.attachments,n=e.AsyncSalesModal,s=e.AsyncFileManager,o=e.AsyncEmailCommunicator,r=e.onClose,l=e.inboxId,d=e.isReply,f=e.message,I=Object(i.useSelector)(V.a),C=Object(h.a)({inboxId:l}).asyncConnectedAccounts,S=Object(z.a)({threadId:I}).publishMessage,v=Object(B.a)(Object(b.a)(C)),R=Object(i.useSelector)(E.a),x=Object(i.useSelector)(K.a),M=Object(i.useSelector)(A.a),N=Object(i.useSelector)(y.a),F=Object(m.l)(f),T=Object(i.useSelector)(A.r);Object(u.useEffect)(function(){Object(O.e)(p.c)},[]);var w=Object(u.useMemo)(function(){return L({attachments:t,connectedAccounts:v,isReply:d,message:f,threadId:I})},[t,v,I,f,d]),q=Object(j.a)({emptyReply:w,reconcileReplies:P.a,hasRecipientSearch:T}),X=Object(c.a)(q,3),G=X[0],Z=X[1],_=X[2],Y=Object(u.useCallback)(function(){r()},[r]),H=Object(u.useCallback)(function(e,t){var n=t.html,a=t.plainText,c=t.options;_();var s=Object(k.o)(e);S(Object(D.a)(e,{html:n,plainText:a},{}),{communicatorType:"floating-reply",replyType:d?"forward-email-reply":"forward",options:Object.assign({},c,{templateId:s,isForwarded:!d})});r()},[S,_,r,d]),W=Object(u.useMemo)(function(){return d?null:function(){return g({conversationsMessageId:F})}},[F,d]);return Object(a.jsx)("div",{className:"floating-components__container",children:Object(a.jsx)("div",{className:"floating-components__component",children:Object(a.jsx)(o,{AsyncFileManager:s,AsyncSalesModal:n,className:"floating-communicator",connectedAccounts:v,conversationsInteract:R,hasVideoAccess:x,fetchEmailHistory:W,gates:M,isReply:d,onChange:Z,onClose:Y,onSend:H,onSendStart:Y,reply:G,threadId:parseInt(I,10),userEmail:N},Object(k.m)(G))})})};G.displayName="ForwardCommunicator";G.propTypes={AsyncEmailCommunicator:o.a.func.isRequired,AsyncFileManager:o.a.func.isRequired,AsyncSalesModal:o.a.func.isRequired,attachments:l.a.listOf(o.a.object),inboxId:o.a.number.isRequired,isReply:o.a.bool.isRequired,message:Object(d.a)("CommonMessage"),onClose:o.a.func};var Z=function(e){var t=e.message,n=e.isReply,s=Object(i.useSelector)(V.a),o=Object(X.a)({message:t,isReply:n,threadId:s}),r=Object(c.a)(o,2),l=r[0];return r[1]?Object(a.jsx)(G,Object.assign({},e,{attachments:l})):null},_=n("xXNX"),Y=n("yHAI"),H=n("P20P"),W=function(e){return Object(a.jsx)(Z,Object.assign({},e,{AsyncEmailCommunicator:_.a,AsyncFileManager:Y.a,AsyncSalesModal:H.a}))};t.default=W},"Zwz/":function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n("MBJP"),c=n("KXN9"),s=n("x1JE"),o=n("JWeH"),i=function(e,t){return t.threadId},r=Object(a.a)([i,o.a],function(e,t){var n=e&&Object(s.b)(e,t);return n&&Object(c.a)(n)})},fXZ3:function(e,t,n){"use strict";n.r(t);var a=n("QgEn"),c=n("YM6t"),s=n("fzi9"),o=n("VfuR"),i=n.n(o),r=n("Ktcs"),l=n("19qb"),u=n("QYOI"),d=n("KXN9"),b=n("os+u"),m=n.n(b),j=n("+Q4j"),O=n("emzX"),p=n.n(O),f=n("snvP"),g=n("Exoo"),h=function(e,t){p()(Object(f.m)(e)===Object(f.m)(t),"Tried to resolve email reply conflicts between replies with different ids");return Object(f.g)(e)!==Object(f.g)(t)?Object(g.f)(Object(f.f)(t),e):e},y=n("RM1X"),A=n("if8Z"),E=n("LB2W"),I=n("zXnf"),C=n("/iZH"),S=n("OJmF"),v=n("Vr8N"),R=n("pxL+"),x=n("IqVT"),M=n("Zwz/"),N=n("Odgs"),F=n("Dlah"),T=n("VsN5"),w=n("Zvm7"),q=n("9kfY"),L=n("+3N0"),P=Object(x.createAction)(T.a.STARTED),V=Object(x.createAction)(T.a.SUCCEEDED),k=function(e,t){var n=t.options;return function(t,a){var c=a(),s=Object(N.a)(c),o=Object(L.a)(c,{message:e}),i=Object(M.a)(a(),{threadId:I.a}),r=Object(w.a)(Object(R.h)(s,o),Object.assign({},n,{associations:i}));t(P());return Object(F.a)(r).then(function(e){t(V({threadId:e.id}));return{threadId:e.id}}).catch(function(e){return t(Object(q.a)(e))})}},X=n("dIqZ"),D=n("BEAo"),K=n("eVil"),z=n.n(K),B=n("tyhE"),G=n("ojzW"),Z=n("5KbK"),_=n("FolP"),Y=n("GOp0"),H=n("Gdeq"),W=n("4mrg"),J=B.a.EMAIL,Q=function(e){var t=e.to,n=void 0===t?Object(u.List)():t,a=e.connectedAccounts,c=n.size?Y.a+"-"+n.map(z()("id")).join("-"):Y.a,s=Object(H.a)(J,c,I.a);return Object(W.a)({replyId:s,metadata:Object(_.a)({from:Object(G.a)(Object(Z.a)(a)),to:n})})},U=n("hogP"),$=n("YVsz"),ee=n("9f1P"),te=n.n(ee),ne=n("eP/i"),ae=n("OI0A"),ce=n("GBWN"),se=n("BiPx"),oe=n("WLqE"),ie=n("46u0"),re=n.n(ie),le=n("7GV/"),ue=te.a.div.withConfig({displayName:"FloatingCapabilityEditor__Wrapper",componentId:"d7i8tm-0"})(["width:600px;background:white;border:0.2px solid #00000026;border-top:none;.DraftEditor-root{min-height:300px !important;}.draft-extend-controls{margin-top:0;}.floating-editor-header > div{padding-left:25px;min-height:0;height:50px;align-items:center;background-color:"," !important;font-size:1rem;}"],ne.SLINKY),de=function(e){var t=e.onSend,n=e.onClose,c=Object(r.useCallback)(function(e,n){t(e,n)},[t]),s=Object(r.useCallback)(function(){return n()},[n]);return Object(a.jsxs)(ue,{"data-selenium-test":"popout-composer-editor",children:[Object(a.jsxs)(ce.a,{className:"floating-editor-header",children:[Object(a.jsx)(oe.a,{style:{fontSize:"1rem"},children:Object(a.jsx)(re.a,{message:"conversations-thread-view.message-metadata-editor.email"})}),Object(a.jsx)(se.a,{className:"m-right-2",style:{top:19,width:"13px"},onClick:s,"data-selenium-test":"close-popout-composer"})]}),Object(a.jsx)(le.a,{errorBoundaryName:"FloatingCapabilityEditor",errorLoggingTitle:"Inbox Floating Capability Editor",children:Object(a.jsx)(ae.a,Object.assign({style:{minHeight:250},onSubmitCMF:c,isMetadataEditorAbsolute:!1},e))},"threadView")]})};de.propTypes={onClose:i.a.func.isRequired,onSend:i.a.func.isRequired};var be=de,me=n("Y8yZ"),je=n("BIq7"),Oe=n("j6mN"),pe=n("2VAE"),fe=n("MLiO"),ge=n("MZef"),he=n("cC+G"),ye=n("uC7A"),Ae=n("NCH/"),Ee=function(e){return{gates:Object(X.a)(e),userFullName:Object(v.a)(e),conversationsInteract:Object(S.a)(e),userEmail:Object(D.a)(e),hasVideoAccess:Object($.a)(e)}},Ie={sendEmail:k},Ce=function(e){var t=e.AsyncEmailCommunicator,n=e.AsyncFileManager,o=e.AsyncSalesModal,i=e.className,b=e.conversationsInteract,m=e.hasVideoAccess,O=e.gates,p=e.inboxId,g=e.onClose,S=e.onSend,v=e.onSendStart,R=e.sendEmail,x=e.userEmail,M=e.userFullName,N=e.to,F=e.renderExistingFileSelect,T=Object(A.a)({inboxId:p,filterNonGlobalAccounts:!0}).asyncConnectedAccounts,w=Object(d.a)(T),q=Object(r.useMemo)(function(){return Q({to:N,connectedAccounts:w})},[N,w]),L=Object(y.a)({emptyReply:q,reconcileReplies:h,hasRecipientSearch:O.has(ye.o)}),P=Object(s.a)(L,3),V=P[0],k=P[1],X=P[2];Object(r.useEffect)(function(){Object(E.e)(C.b)},[]);var D=Object(r.useCallback)(function(e,t){X();v();R(e,{options:t}).then(function(e){var t=e.threadId;return S({threadId:t})});Object(E.e)(Object(Ae.f)({channel:j.EMAIL,messageChannel:j.EMAIL,communicatorType:"compose",timeToReply:-1,numberOfTicketsAssociated:0}))},[X,R,S,v]),K=Object(r.useCallback)(function(e,t){var n=t.html,a=t.plainText,c=Object(f.o)(e),s=Object(U.a)(e,{html:n,plainText:a},{});D(s,{options:{templateId:c}})},[D]),z=Object(l.useSelector)(me.a),B=Object(r.useMemo)(function(){return[].concat(Object(c.a)(je.b),Object(c.a)(Oe.b))},[]),G=Object(he.a)(B,{auth:z,limits:pe.d,renderCommunicator:void 0,renderExistingFileSelect:F});if(O.has(ye.o)){var Z=new fe.a({threadId:I.a,inboxId:p}),_=Object(ge.a)({status:"SUCCESS",data:q});return Object(a.jsx)(be,{asyncAssociations:Object(u.Map)({}),asyncConnectedAccounts:T,asyncEmptyReply:_,auth:z,capabilitiesConfig:G,threadDetails:Z,className:i,onClose:g,onSend:D,isNewEmailComposition:!0})}return Object(a.jsx)(t,{AsyncFileManager:n,AsyncSalesModal:o,className:i,connectedAccounts:w,conversationsInteract:b,hasVideoAccess:m,gates:O,isReply:!1,onChange:k,onClose:g,onSend:K,reply:V,threadId:I.a,userEmail:x,userFullName:M})};Ce.displayName="ComposeCommunicatorContainer";Ce.propTypes={className:i.a.string,conversationsInteract:i.a.bool.isRequired,gates:Object(b.setOf)(i.a.string).isRequired,hasVideoAccess:i.a.bool.isRequired,inboxId:i.a.number.isRequired,onClose:i.a.func,onSend:i.a.func,sendEmail:i.a.func.isRequired,to:m.a.list,userEmail:i.a.string.isRequired,userFullName:i.a.string};Ce.defaultProps={onSend:function(){},onSendStart:function(){}};var Se=Object(l.connect)(Ee,Ie)(Ce),ve=n("xXNX"),Re=n("yHAI"),xe=n("P20P"),Me=n("Uj7t"),Ne=function(e){return Object(a.jsx)(Me.a,Object.assign({},e))},Fe=function(e){return Object(a.jsx)(Se,Object.assign({},e,{AsyncEmailCommunicator:ve.a,AsyncFileManager:Re.a,AsyncSalesModal:xe.a,renderExistingFileSelect:Ne}))};t.default=Fe},tyhE:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a={EMAIL:"EMAIL",CHAT:"LIVE_CHAT",FACEBOOK_MESSENGER:"FACEBOOK_MESSENGER",FORMS:"FORMS"}}}]);
//# sourceMappingURL=compose-communicator.js.map