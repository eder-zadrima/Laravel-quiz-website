(window.webpackJsonp=window.webpackJsonp||[]).push([["deal-conversations-card-content"],{"1Md+":function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n="CLOSED"},XiCU:function(e,t,a){"use strict";a.r(t);var n=a("OwGx"),i=a("LljG"),s=a.n(i),r=a("fFSu"),o=a("YM6t"),c=a("vTCD"),d=a("k8Et"),l=a("mNyx"),u=a("txVw"),b=a("pGTB"),p=a("QgEn"),m=a("VfuR"),f=a.n(m),j=a("Ktcs"),v=a("QYOI"),k=a("omic"),g=a.n(k),O=a("iDkV"),h=a.n(O),y=a("6l6v"),S=a.n(y),N=a("46u0"),C=a.n(N),I=a("E7+s"),D=a("os+u"),P=a.n(D),x=a("mDbF"),A=a.n(x),F=a("P4dz"),T=a("DSKb"),R=a("lkn+"),M=Object(v.Record)({active:!0,closedWon:!1,displayOrder:-1,label:"",probability:0,stageId:void 0},"DealStage");M.fromJS=function(e){return e&&"object"==typeof e?M(e):e};var L=M,w=a("Zwtj"),_=a("aeBh"),E=a("Q6fd"),V=a("UMxk"),q=a("JyZI"),B=a("021V"),U=a("vuW9"),z=Object(v.fromJS)([{probability:.1,displayOrder:0},{probability:.2,displayOrder:1},{probability:.3,displayOrder:2},{probability:.4,displayOrder:3},{probability:.5,displayOrder:4},{probability:.6,displayOrder:5},{probability:.7,displayOrder:6},{probability:.8,displayOrder:7},{probability:.9,displayOrder:8},{probability:1,displayOrder:9}]).push(Object(v.Map)({probability:0,displayOrder:10})),K=function(e){Object(b.a)(t,e);function t(){var e;Object(c.a)(this,t);(e=Object(l.a)(this,Object(u.a)(t).call(this))).renderStage=e.renderStage.bind(Object(V.a)(e));return e}Object(d.a)(t,[{key:"getClassName",value:function(e){var t=this.props.currentStage,a=100*e.get("probability"),n=10*Math.ceil(a/10);(0===t.get("probability")&&t.get("stageId")!==e.get("stageId")||e.get("displayOrder")>t.get("displayOrder"))&&(n="empty");return"probability-bar probability-color-"+n}},{key:"renderStage",value:function(e,t){var a=this.props,n=a.currentStage,i=a.stages,s=Object(p.jsx)(B.a,{className:this.getClassName(e)},t);return n.get("stageId")===e.get("stageId")||i.size>11&&n.get("probability")===e.get("probability")?Object(p.jsx)(U.a,{title:n.get("label"),children:s},t):s}},{key:"renderStages",value:function(){var e=this.props.stages;return e.size<=11?e.map(this.renderStage):z.map(this.renderStage)}},{key:"render",value:function(){var e=this.props.className;return Object(p.jsx)(q.a,{className:e,children:this.renderStages()})}}]);return t}(j.PureComponent);K.propTypes={className:f.a.string.isRequired,currentStage:f.a.oneOfType([f.a.instanceOf(v.Map),f.a.instanceOf(L)]),stages:f.a.instanceOf(v.List).isRequired};K.defaultProps={className:"m-bottom-3"};var H=K,Q=a("cWXR"),W=a("uI75"),J=a("MQNR"),G=a("nDpY"),Y=a.n(G),Z=a("MH0N"),X=a("WbQG"),$=function(e){return"/contacts/"+Y.a.get()+"/company/"+e},ee=function(e){return"/contacts/"+Y.a.get()+"/contact/"+e},te=function(e){return"/deals/"+Y.a.get()+"/deal/"+e},ae=function(e,t){if(!e)return Object(p.jsx)("span",{children:"-"});var a=Object(F.d)(e,"deal_currency_code"),n=Object(F.d)(e,"amount"),i=Object(F.g)(e);return t?i:n?Object(p.jsxs)("span",{children:[Object(p.jsx)(Z.a,{className:"p-right-1",currencyCode:a,placeholder:"",simplifyCurrency:!1,value:n}),i]}):Object(p.jsx)("span",{children:i})},ne=function(e){Object(b.a)(t,e);function t(){var e;Object(c.a)(this,t);(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={isHovering:!1};return e}Object(d.a)(t,[{key:"getCloseDate",value:function(){var e=this.props.subject,t=Object(F.d)(e,"closedate");if(t&&(t=A.a.moment.userTz(+t)).isValid())return t.format("LL")}},{key:"getDealAmount",value:function(){var e=this.props.subject,t=Object(F.d)(e,"deal_currency_code"),a=Object(F.d)(e,"amount");return a?Object(p.jsx)("span",{children:Object(p.jsx)(Z.a,{className:"p-right-1",currencyCode:t,placeholder:"",simplifyCurrency:!1,value:a})}):null}},{key:"getAssociationLookup",value:function(e,t,a){return e?e.map(function(e){var n=Object(F.a)(e);return{type:t,primaryIdentifier:n,displayName:Object(F.g)(e),href:a(n)}}).toArray():[]}},{key:"getAssociations",value:function(e,t,a){return[].concat(this.getAssociationLookup(a,"dealId",te)).concat(this.getAssociationLookup(t,"companyId",$)).concat(this.getAssociationLookup(e,"vid",ee))}},{key:"renderStages",value:function(){var e=this.props,t=e.pipelineStages,a=e.stage;return t&&a?[Object(p.jsx)(H,{className:"p-y-2",currentStage:a,stages:t})]:[]}},{key:"renderStageField",value:function(){var e=this.props,t=e.isEditable,a=e.onStageChange,n=e.pipelineStages,i=e.stage,s=Object(X.b)(i.get("label"));if(t&&a&&n){var r=n.map(function(e){return{text:Object(X.b)(e.get("label")),value:e.get("stageId")}}).toArray();return Object(p.jsxs)("div",{children:[Object(p.jsx)(W.a,{children:Object(p.jsx)(C.a,{message:"customerDataObjectsUiComponents.DealChicklet.editableStage"},"status")}),Object(p.jsx)(T.a,{className:"p-left-1",buttonUse:"link",menuWidth:250,onChange:a,options:r,value:i.get("stageId")})]},"stage")}return Object(p.jsxs)("div",{className:"truncate-text",children:[Object(p.jsx)(W.a,{children:Object(p.jsx)(C.a,{message:"customerDataObjectsUiComponents.DealChicklet.stage"})}),s]},"stage")}},{key:"renderFields",value:function(){var e=this.props,t=e.stage,a=e.useCompactChicklet,n=t&&Object(X.b)(t.get("label")),i=this.getCloseDate(),s=this.getDealAmount(),r=[];n&&r.push(this.renderStageField());s&&a&&r.push(Object(p.jsxs)("div",{className:"truncate-text",children:[Object(p.jsx)(W.a,{children:Object(p.jsx)(C.a,{message:"customerDataObjectsUiComponents.DealChicklet.dealAmount"})}),s]},"dealAmount"));i&&r.push(Object(p.jsxs)("div",{className:"truncate-text",children:[Object(p.jsx)(W.a,{children:Object(p.jsx)(C.a,{message:"customerDataObjectsUiComponents.DealChicklet.closeDate"})}),i]},"closeDate"));return r}},{key:"render",value:function(){var e=this.props,t=e.associatedCompanies,a=e.associatedContacts,n=e.associatedDeals,i=e.className,s=e.iconSize,r=e.isBoard,o=e.isEditable,c=e.isPreviewDisabled,d=e.onCardClick,l=e.onClick,u=e.onExternalClick,b=e.onRemoveClick,m=e.recordHref,f=e.subject,j=e.useCompactChicklet,v=this.renderStages(),k=this.renderFields(),g=this.getAssociations(a,t,n),O=j?function(e){e.stopPropagation();u&&u()}:u;return Object(p.jsx)(W.b,{associations:g,className:i,iconSize:s,isBoard:r,isEditable:o,isPreviewDisabled:c,objectType:J.DEAL,onClick:l,onExternalClick:O,onCardClick:d,onRemoveClick:b,oneLinersAboveDescription:v,oneLinersBelowDescription:k,recordHref:m,seleniumSelector:"deal-chicklet",subject:f,title:ae(f,j),useCompactChicklet:j})}}]);return t}(j.PureComponent);ne.propTypes={associatedCompanies:Object(D.listOf)(f.a.instanceOf(w.a)),associatedContacts:Object(D.listOf)(f.a.instanceOf(_.a)),associatedDeals:Object(D.listOf)(f.a.instanceOf(E.a)),className:f.a.string,iconSize:f.a.oneOfType([f.a.oneOf(Object.keys(Q.c)),f.a.number]),isBoard:f.a.bool,isEditable:f.a.bool,isPreviewDisabled:f.a.bool,onCardClick:f.a.func,onClick:f.a.func,onExternalClick:f.a.func,onRemoveClick:f.a.func,onStageChange:f.a.func,pipelineStages:Object(D.listOf)(f.a.oneOfType([f.a.instanceOf(v.Map),f.a.instanceOf(L)])),recordHref:f.a.string,stage:f.a.oneOfType([f.a.instanceOf(v.Map),f.a.instanceOf(L)]),subject:R.a.isRequired,useCompactChicklet:f.a.bool};ne.defaultProps={iconSize:8};var ie=a("5jW3"),se=a("xqzv"),re=a("tPYf"),oe=a("2IJn"),ce=a("inIR"),de=a("leqx"),le=a("KbK+"),ue=a("svxk"),be=a("U0V+"),pe=a.n(be),me=a("EvX1"),fe=a.n(me),je=function(e){var t={},a=g()(["user","scopes"],e);a&&(t=a.reduce(function(e,t){e[t]=!0;return e},{}));return t},ve=function(e){var t,a=g()(["user","scopes"],e),n=g()(["user","teams"],e);a&&n&&(t=pe()("id",n));return t},ke=function(e,t,a){var n=Object(F.c)(e);return n!==J.FEEDBACK_SUBMISSION&&Object(le.a)(new v.Set([Object(F.d)(e,"hubspot_owner_id")]),new v.Set([Object(F.d)(e,"hubspot_team_id")]).filter(fe.a),je(t),a,ve(t),Object(F.d)(e,"hubspot_owner_id"),n)},ge=function(e,t,a){return Object(ue.a)(new v.Set([Object(F.d)(e,"hubspot_owner_id")]),new v.Set([Object(F.d)(e,"hubspot_team_id")]).filter(fe.a),je(t),a,ve(t),Object(F.d)(e,"hubspot_owner_id"),Object(F.c)(e))},Oe=a("DqRu"),he=a("eVil"),ye=a.n(he);function Se(e){return!0===ye()("bet-create-deals-by-top-bar-restriction",e)}function Ne(e){return Se(e)}var Ce=function(e){var t=g()(["user","scopes"],e),a={};t&&(a=t.reduce(function(e,t){e[t]=!0;return e},{}));return a},Ie=function(e){return Ne(Ce(e))},De=function(e,t){var a=Ce(t);return!(e===J.COMPANY&&!Object.prototype.hasOwnProperty.call(a,"bet-change-associated-company"))},Pe=5,xe=5,Ae=function(e,t){return"/contacts/"+Y.a.get()+"/deals/list/view/all/?associations-"+t.toLowerCase()+"="+e},Fe=function(e){return"/contacts/"+Y.a.get()+"/deal/"+e},Te=function(e){Object(b.a)(t,e);function t(){var e;Object(c.a)(this,t);(e=Object(l.a)(this,Object(u.a)(t).call(this))).handleFetchMore=function(t){e.props.onFetchMoreAssociations();e.setState({isShowingMore:!0,offset:t})};e.handleShowLess=function(){e.setState({isShowingMore:!1,offset:0,isShowingAll:!1})};e.handleShowMore=function(){var t=e.props,a=t.count,n=t.onFetchMore,i=t.hasMore,s=e.state.offset+xe,r=Pe+s;if(n)n();else if(r>=a&&i)return e.handleFetchMore(s);r>=a?e.setState({isShowingAll:!0}):e.setState({isShowingMore:!0,offset:s});return null};e.handleRecordClick=function(){Object(oe.c)(e.props.tracker,{subType:ce.a,type:J.DEAL})};e.state={isShowingMore:!1,isShowingAll:!1,offset:0};return e}Object(d.a)(t,[{key:"getNumberOfItems",value:function(){return this.state.isShowingAll?this.props.count:this.state.isShowingMore?Pe+this.state.offset:Pe}},{key:"renderShowLess",value:function(){return Pe===this.getNumberOfItems()?null:Object(p.jsx)("p",{children:Object(p.jsx)(Oe.a,{onClick:this.handleShowLess,use:"link",children:Object(p.jsx)(C.a,{message:"customerDataSidebar.MultiEntryCard.viewLess"})})})}},{key:"renderShowMore",value:function(){return this.props.count<=Pe+this.state.offset?null:Object(p.jsx)("p",{children:Object(p.jsx)(Oe.a,{onClick:this.handleShowMore,use:"link",children:Object(p.jsx)(C.a,{message:"customerDataSidebar.MultiEntryCard.viewMore"})})})}},{key:"renderShowMoreButton",value:function(){return this.state.isShowingAll?this.renderShowLess():this.renderShowMore()}},{key:"render",value:function(){var e,t,a=this,n=this.props,i=n.auth,s=n.cardButtons,r=n.count,o=n.currentOwnerId,c=n.hasMore,d=n.isLoaded,l=n.items,u=n.objectType,b=n.onPreviewRecord,m=n.onRemoveClick,f=n.subject,j=n.useViewMore,v=n.viewAllOnClick,k=!Ie(i)||De(u,i);l&&(e=l.map(function(e){return Object.assign({},e,{isEditable:ke(e.subject,i,o)&&k,isPreviewDisabled:!ge(e.subject,i,o),key:Object(F.a)(e.subject),onClick:b,onExternalClick:a.handleRecordClick,onRemoveClick:m,recordHref:Fe(Object(F.a)(e.subject))})}));f&&(t=u===J.TICKET||j?{showMoreLessButton:this.renderShowMoreButton()}:{viewAllLink:Ae(Object(F.a)(f),u)});return Object(p.jsx)(ie.a,Object.assign({cardButtons:s,cardType:se.a.DEALS,className:d?"reagan-test-"+se.a.DEALS:"",Component:ne,count:r,hasMore:c,items:e,maxItemsToShow:this.getNumberOfItems(),objectType:u,subject:f,viewAllOnClick:v},t))}}]);return t}(j.PureComponent);Te.propTypes={auth:f.a.object,cardButtons:f.a.array,className:f.a.string,count:f.a.number,currentOwnerId:f.a.number,hasMore:f.a.bool,isLoaded:f.a.bool,items:f.a.array,objectType:de.a.isRequired,onFetchMore:f.a.func,onFetchMoreAssociations:f.a.func,onPreviewRecord:f.a.func,onRemoveClick:f.a.func,subject:re.a,tracker:f.a.object,useViewMore:f.a.bool,viewAllOnClick:f.a.func};var Re=Te,Me=a("mKxs"),Le=function(e){Object(b.a)(t,e);function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).handleFetchMore=function(){var e=a.props,t=e.conversationId,n=e.countObject,i=e.conversationItemsCursor,s=e.conversationItems,r=e.objectType,c=e.fetchMore,d=e.subjectId;s.length<n.count&&c&&c({variables:{conversationId:t,cursor:i,objectType:r,subjectId:parseInt(d,10)},updateQuery:function(e,t){var a=t.fetchMoreResult,n=g()(["crmObject","associations","toDealIntersectedWithConversation","andConversation"],e),i=g()(["crmObject","associations","toDealIntersectedWithConversation","andConversation","edges"],a),s=g()(["crmObject","associations","toDealIntersectedWithConversation","andConversation","pageInfo"],a);return i.length?h()(["crmObject","associations","toDealIntersectedWithConversation","andConversation"],{__typename:n.__typename,edges:[].concat(Object(o.a)(n.edges),Object(o.a)(i)),pageInfo:s},e):e}})};return a}Object(d.a)(t,[{key:"getItemsData",value:function(e){var t=this.props,a=t.companyAssociationsById,n=t.contactAssociationsById,i=t.changeBuilder,s=t.getDraftProperty,r=t.pipelinesById;return(e||[]).map(function(e){var t,o,c=s(e,"dealstage")||Object(F.d)(e,"dealstage"),d=Object(F.d)(e,"pipeline"),l=g()([d,"stageOptions"],r);if(l){t=Object(v.List)(l.map(function(e){return Object(v.Map)(e)}));o=l.find(function(e){return e.stageId===c})}return{associatedCompanies:a[Object(F.a)(e)],associatedContacts:n[Object(F.a)(e)],objectType:J.DEAL,onStageChange:i(e,"dealstage"),pipelineStages:t,stage:Object(v.Map)(o),subject:e}})}},{key:"renderWithConversations",value:function(){var e=this.props,t=e.auth,a=e.cardButtons,n=e.conversationItems,i=e.conversationItemsCount,s=e.countObject,r=e.currentOwnerId,o=e.isLoaded,c=e.items,d=e.objectType,l=e.onPreviewRecord,u=e.onRemoveAssociation,b=e.subject,m=e.tracker,f=s.count-i,j=f?null:a,v=f?a:null;return Object(p.jsxs)("div",{children:[Object(p.jsx)(C.a,{message:"conversations-inbox-ui.crm-integration.DealsCard.associatedToConversationLabel"}),Object(p.jsx)(Re,{auth:t,cardButtons:j,count:i,currentOwnerId:r,isLoaded:o,items:this.getItemsData(n),objectType:d,onFetchMore:this.handleFetchMore,onPreviewRecord:l,onRemoveClick:u,subject:b,tracker:m,useViewMore:!0}),0!==f&&[Object(p.jsx)(C.a,{message:"conversations-inbox-ui.crm-integration.DealsCard.otherAssociationsLabel"},"label"),Object(p.jsx)(Re,{auth:t,cardButtons:v,count:s.count,currentOwnerId:r,isLoaded:o,items:this.getItemsData(c),objectType:d,onPreviewRecord:l,onRemoveClick:u,subject:b,tracker:m},"singly-associated-list")]]})}},{key:"renderDefaultList",value:function(){var e=this.props,t=e.countObject,a=e.items,n=e.onRemoveAssociation,i=e.subject,s=Object(r.a)(e,["countObject","items","onRemoveAssociation","subject"]),o=this.getItemsData(a);return Object(p.jsx)(Re,Object.assign({count:t.count,onFetchMore:this.handleFetchMore,hasMore:t.hasMore,items:o,onRemoveClick:n,subject:i},s))}},{key:"render",value:function(){return Object(I.e)(this.props.subject)?this.props.conversationItems&&!S()(this.props.conversationItems)?this.renderWithConversations():this.renderDefaultList():null}}]);return t}(j.PureComponent);Le.propTypes={associatedCompaniesById:f.a.objectOf(Object(Me.a)("CompanyRecord")),associatedContactsById:f.a.objectOf(Object(Me.a)("ContactRecord")),auth:f.a.object,cardButtons:f.a.array,changeBuilder:f.a.func.isRequired,companyAssociationsById:f.a.object,contactAssociationsById:f.a.object,conversationId:f.a.string,conversationItems:f.a.arrayOf(Object(Me.a)("DealRecord")),conversationItemsCount:f.a.number,conversationItemsCursor:f.a.string,countObject:f.a.object,currentOwnerId:f.a.number,cursor:f.a.string,fetchMore:f.a.func,getDraftProperty:f.a.func.isRequired,isLoaded:f.a.bool,items:f.a.arrayOf(Object(Me.a)("DealRecord")),objectType:de.a,onPreviewRecord:f.a.func,onRemoveAssociation:f.a.func,pipelinesById:f.a.object,subject:re.a,subjectId:f.a.string,tracker:f.a.object};Le.defaultProps={countObject:{count:0,hasMore:!1}};var we=a("dwuz"),_e=a("fzi9"),Ee=a("pPiP"),Ve=a.n(Ee),qe=a("sszm"),Be=a("+KT1"),Ue=a.n(Be),ze=a("4ukM"),Ke=a.n(ze),He=a("mpvR"),Qe="customerDataSidebar.aboutCard",We=Qe+".betUpdatePropertiesErrors",Je={PIPELINE_ALREADY_SET:We+".pipelineAlreadySet",INVALID_PROPERTY_VALUE_CHANGE_ON_CLOSED_DEAL:We+".invalidPropertyValueChangeOnClosedDeal",NAME_CHANGE_OF_ACTIVE_COMPANY:We+".nameChangeOfActiveCompany"},Ge=function(e){Object(He.c)(Je[e]||Qe+".alertUpdatePropertiesError")},Ye=a("MyjV"),Ze=a("8qhJ"),Xe=a.n(Ze),$e=a("jqvl"),et=a.n($e),tt=a("aitF"),at=a.n(tt),nt=a("muUi"),it=a("Uh/y"),st=a("bCAt"),rt=a("rsMa"),ot=a("nqVS"),ct=a("sSdB"),dt=a("uzdC"),lt=a("t81I"),ut=a("j/Up"),bt=a("1RCs"),pt=a("EDR3"),mt=function(e){return null==e||0===(""+e).trim().length},ft="deals::sync_company_lifecyclestage",jt=function(e){return!0===e||"true"===e},vt="hs_analytics_source_data_1",kt="hs_analytics_source_data_2",gt=function(e){return Object(F.d)(e,vt)===bt.i},Ot=function(e){return Object(F.d)(e,vt)===bt.h&&!isNaN(Object(F.d)(e,kt))},ht=function(e){Object(b.a)(t,e);function t(e){var a;Object(c.a)(this,t);(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).getIsSaveDisabled=function(){var e=a.props.properties,t=a.state.draft;return e.some(function(e){if(!e.get("required"))return!1;var a=t.get(e.get("property"));return mt(a)})};a.handleConfirm=function(){var e=a.state.draft.toJS(),t=Object.keys(e).reduce(function(t,i){return a.state.changedInSession.has(i)?Object.assign({},t,Object(n.a)({},i,e[i])):t},{}),i=a.shouldUpdateDealCloseDateOnSave(a.state.changedInSession.has("closedate"))?Object.assign({},t,{closedate:A.a.moment.userTz().valueOf()}):t;return a.props.onConfirm(i)};a.handleChange=function(e,t){var n=null!=t.target?t.target.value:void 0;n=rt.d(e,n);a.setState(function(t){return{draft:t.draft.set(e.name,n),changedInSession:t.changedInSession.add(e.name)}})};a.renderProperty=function(e,t){var n=a.props,i=n.nextProperties,s=n.objectType,r=n.resolvers,o=n.subject,c=n.subjectProperties,d=n.getPropertyInputResolver,l=n.PropertyInput,u=n.getPropertyPermission,b=a.state.draft,m=c.get(e.get("property"));if(!m)return null;var f=m.name,j=u(f)===pt.a,v="dealstage"===f?{nextPipeline:i.get("pipeline")}:void 0,k=d(r,m,s,{isIntegration:gt(o),isImport:Ot(o)});return Object(p.jsx)(dt.a,{label:a.renderPropertyLabel(m),labelTooltip:!j&&Object(p.jsx)(C.a,{message:"fieldLevelPermissions.READ_ONLY"}),required:e.get("required"),children:Object(p.jsx)(l,Object.assign({autoFocus:0===t,baseUrl:"/contacts/"+Y.a.get()+"/contact/email/",readOnlySourceData:{isKnownGuid:lt.b,getGuidLabel:lt.a},objectType:s,property:m,resolver:k,value:b.get(f),onChange:a.partial(a.handleChange,m),subjectId:""+Object(F.a)(o),subject:o,readOnly:!j},v))},f)};a.partial=at()(Ve.a);if(!e.subject)return Object(l.a)(a);var i=e.properties.reduce(function(t,a){var n=a.get("property");if(t.has(n))return t;var i=e.nextProperties.get(n)||Object(F.d)(e.subject,n),s=e.prevStage&&e.prevStage.get("probability")&&+e.prevStage.get("probability"),r=e.nextStage.get("probability")&&+e.nextStage.get("probability");"closedate"===n&&[0,1].includes(r)&&s!==r&&(i=A.a.moment.userTz().valueOf());return t.set(n,i)},Object(v.Map)()),s=Object(v.List)(),r=Object(v.List)();e.properties.forEach(function(e){var t=i.get(e.get("property"));mt(t)?r=r.push(e):s=s.push(e)});a.state={changedInSession:Object(v.Set)(),draft:i,propertiesByType:{completed:s,empty:r}};return a}Object(d.a)(t,[{key:"shouldUpdateDealCloseDateOnSave",value:function(e){if(J.DEAL!==this.props.objectType)return!1;if(e)return!1;var t=this.props.nextStage.get("probability")&&Number(this.props.nextStage.get("probability")),a=[0,1].includes(t),n=Number(ye()("probability",this.props.prevStage));return!(!a||n===t)}},{key:"renderIsSyncedMessage",value:function(){var e=this.props,t=e.objectType,a=e.settings,n=e.nextProperties;return t===J.DEAL&&1===n.get("probability")&&a&&jt(a.get(ft))?Object(p.jsx)("p",{children:Object(p.jsx)(et.a,{message:"customerDataProperties.dealClosedModal.syncMessage"})}):null}},{key:"renderPropertyLabel",value:function(e){var t=e.hubspotDefined?Object(X.b)(e.label):e.label;if(e.description){var a=e.hubspotDefined?Object(X.a)(e.label,e.description):e.description;return Object(p.jsx)(U.a,{title:a,children:Object(p.jsx)("span",{children:t})})}return Object(p.jsx)("span",{children:t})}},{key:"renderEmptyProperties",value:function(e){return S()(e)?null:Object(p.jsx)(ct.a,{children:e.map(this.renderProperty)})}},{key:"renderCompletedProperties",value:function(e,t){return S()(e)?null:Object(p.jsx)(ot.a,{className:"p-y-3",defaultOpen:S()(t),size:"small",title:Object(p.jsx)(C.a,{message:"customerDataProperties.StageChangeDialog.completedProperties"}),children:e.map(this.renderProperty)})}},{key:"render",value:function(){var e=this.props,t=e.nextStage,a=e.objectType,n=e.onReject,i=e.properties,s=e.subject,r=this.state.propertiesByType,o=r.completed,c=r.empty,d=a===J.TICKET?"ticket":"deal";return Object(p.jsxs)(it.a,{confirmDisabled:this.getIsSaveDisabled(),onConfirm:this.handleConfirm,onReject:n,title:Object(p.jsx)("h3",{children:Object(p.jsx)(C.a,{message:"customerDataProperties."+d+"StageChangeModal.title"})}),children:[Object(p.jsx)("p",{children:Object(p.jsx)(et.a,{message:"customerDataProperties."+d+"StageChangeModal.message",options:{count:i.size,name:Object(F.g)(s),stage:t.get("label")}})}),this.renderIsSyncedMessage(),this.renderEmptyProperties(c),this.renderCompletedProperties(o,c)]})}}]);return t}(nt.a);ht.propTypes=Object.assign({getPropertyInputResolver:f.a.func.isRequired,prevStage:P.a.map,nextStage:P.a.map.isRequired,objectType:f.a.string.isRequired,prevProperties:P.a.map.isRequired,nextProperties:P.a.map.isRequired,properties:P.a.list.isRequired,PropertyInput:f.a.elementType.isRequired,subject:P.a.record.isRequired,subjectProperties:P.a.map.isRequired,settings:P.a.map.isRequired,getPropertyPermission:f.a.func.isRequired},st.a);var yt=Object(ut.a)(function(e){return{resolvers:e}},ht),St=a("CkxV"),Nt=a("B0Kw"),Ct=a("Sebf"),It=a("i+U4"),Dt=["closedate","closed_lost_reason","closed_won_reason"],Pt=["hs_ticket_category","hs_resolution"];function xt(e,t){return t===J.DEAL&&e&&Object(v.Set)(e).has("revenue-deal-stage-change-dialog")?It.a:yt}var At=function(e){var t=e.getPropertyInputResolver,a=e.PropertyInput,n=e.subject,i=e.prevStage,s=e.nextStage,r=e.objectType,c=e.prevProperties,d=e.nextProperties,l=e.stageProperties,u=e.saveCallback,b=e.cancelCallback,p=e.settings,m=e.subjectProperties,f=e.getPropertyPermission,j=void 0===f?function(){return pt.a}:f,v=e.scopes,k=r===J.TICKET?Pt:Dt,g=Object(Nt.a)(Object(Ct.b)())(xt(v,r));Object(St.a)(g)({nextProperties:d,prevStage:i,nextStage:s,objectType:r,prevProperties:c,properties:l,subject:n,getPropertyInputResolver:t,PropertyInput:a,settings:p,subjectProperties:m,getPropertyPermission:j}).then(function(e){var t=l.map(function(e){return e.get("property")}).toJS(),a=Xe()([].concat(Object(o.a)(Array.from(t)),Object(o.a)(Array.from(k))),e);return u(a)},function(){b()})},Ft=a("1Md+"),Tt=a("mljZ"),Rt=a.n(Tt),Mt=a("7ZxE"),Lt=a.n(Mt),wt=a("8QMF"),_t=a.n(wt),Et=a("qvRI"),Vt=a("LZPL"),qt=a.n(Vt),Bt=Object(v.fromJS)({QA:{default:{blacklistAddStages:["closedwon","bfdd4888-f2f2-417e-9310-38818a28ddaa","467b66d6-bc15-41bf-bae0-03cbc24b4006"],blacklistRemoveStages:["closedlost","closedwon","bfdd4888-f2f2-417e-9310-38818a28ddaa","467b66d6-bc15-41bf-bae0-03cbc24b4006"],closedLost:"closedlost"},"37f54e6a-2dcc-4800-919a-4af81cd013da":{closedLost:"5d79a601-1509-46fc-9c5f-66f0613c5140"},"489d75c9-6d9c-4c21-9337-78479e9eab8a":{blacklistAddStages:["7e267087-ac36-47d2-95c1-3c48b8a1fc1c","7af69936-e7da-44ea-afe0-f126cf42916a"],blacklistRemoveStages:["118251b5-e1ce-4caf-bf8f-5423bf1f2fd8","7e267087-ac36-47d2-95c1-3c48b8a1fc1c","7af69936-e7da-44ea-afe0-f126cf42916a","856f2637-879f-4905-91a0-85ccb90ea80c"],closedLost:"118251b5-e1ce-4caf-bf8f-5423bf1f2fd8"},"9b4c4174-b45f-4039-99e5-0407ba9fab50":{closedLost:"94d29ab5-9fa9-4757-ac63-50a6a694e1f4"},"9a8ef7b3-3525-42e1-b595-86d51512a25f":{blacklistAddStages:["0aeba8be-7c87-490d-a3c2-5c03f85342c7","327be878-4720-408a-8190-525f51517623"],blacklistRemoveStages:["075d6493-c914-45e5-aa6a-80fd4fc61583","0aeba8be-7c87-490d-a3c2-5c03f85342c7","327be878-4720-408a-8190-525f51517623","768ed4f3-0f29-42a9-ad76-3a640989b33e"],closedLost:"075d6493-c914-45e5-aa6a-80fd4fc61583"},"01478afe-76e3-456e-a016-290ebd4d0bf7":{closedLost:"b7879922-feda-4f67-aaef-177a03dcbe1f"},"6d9d2ec3-b80f-4e42-8d00-991cb9cf8e47":{closedLost:"ea230232-e63b-4523-a5a5-cf43d7050255"},"bec8a5a8-e960-47a6-a823-383d0fcb6628":{closedLost:"518b6f04-bbfa-4a18-aa4b-8a017d9b542d"},"b0fcedf4-0fde-4771-9c1a-92236f6a5c99":{closedLost:"fdd7cca3-ff14-4479-88ec-f19011bd5b24"},"7c8c0fe3-1bc8-4f90-a718-363a07d76201":{closedLost:"a063d7cf-b7bf-4591-9edf-832a074c4dc1"}},PROD:{default:{blacklistAddStages:["e8b4d558-d53b-4594-8451-69ad8d0abc1c","05e6bc54-0d94-4edb-92ca-d791164dab14","closed_lost"],blacklistRemoveStages:["ebe0fe63-a0c1-4167-b2d7-b06156616b17","e8b4d558-d53b-4594-8451-69ad8d0abc1c","05e6bc54-0d94-4edb-92ca-d791164dab14","closed_lost"],closedLost:"ebe0fe63-a0c1-4167-b2d7-b06156616b17"},"dc15cb0e-592c-4007-803f-a79c1449bd62":{closedLost:"d5812a2f-a86e-4ac7-ae63-d6f5caea3f22"},"39ae23a8-8a0a-44cb-8d26-7bd79bc9437d":{blacklistAddStages:["8f996bf5-e073-4951-806c-5cee79f665b5","bbeef4ba-6a19-4b7d-beb3-ceaa999ebebe"],blacklistRemoveStages:["137b8391-a3a5-4c3c-ad54-5703a1533ba5","8f996bf5-e073-4951-806c-5cee79f665b5","bbeef4ba-6a19-4b7d-beb3-ceaa999ebebe","deb5476d-ec11-44f1-a685-b7855ae8cd43"],closedLost:"137b8391-a3a5-4c3c-ad54-5703a1533ba5"},"bea4be68-40d0-42c9-9867-62a204008311":{closedLost:"2e235bac-b435-4834-a6ba-f9d7ee0a7393"},"85e453ef-e47b-430e-80d4-bf9df054a8b7":{blacklistAddStages:["40ac60cd-eaab-46b4-880d-323e8eadc20a","0f028cdf-dfa4-465e-b203-cc7e93bf79c0"],blacklistRemoveStages:["ce74f39b-10b3-416d-8797-b2a875ccb8cf","40ac60cd-eaab-46b4-880d-323e8eadc20a","0f028cdf-dfa4-465e-b203-cc7e93bf79c0","3ef42d9b-6453-4e19-ae8b-13926a841f64"],closedLost:"ce74f39b-10b3-416d-8797-b2a875ccb8cf"},"a126ca5c-e784-4b2d-8aa3-c8910578b05a":{closedLost:"df5bbbee-38e0-4685-9b4d-47f2c065da2d"},"e00907ea-db09-4ff3-bd58-83516212757a":{closedLost:"c4bf3747-e75d-4388-b764-3c2cc9f5a3d4"},"c90cfee0-df03-4abe-a647-8dc4d0aa1afb":{closedLost:"76cff0fa-e196-4aa8-b898-8c938252bbe2"},"eda9c4f2-63c7-4170-80b0-6f6364fa8cc4":{closedLost:"7a49ee11-da21-4e9f-bc71-29453781125a"},"a7503d91-a182-4862-81fc-361a70348394":{closedLost:"e350d3ef-f64e-4c7c-ab94-c48f0759dc0c"}}}),Ut=at()(function(e,t,a,n){if(n.has("bet-bypass-deal-stage-restrictions"))return!0;var i=qt.a.isQa()?"QA":"PROD",s=Bt.getIn([i,e,"blacklistAddStages"]),r=Bt.getIn([i,e,"blacklistRemoveStages"]);return!(s&&s.includes(a)||r&&r.includes(t))}),zt=function(e,t,a,n,i){if(Ut(e,t,a,n))return!0;i&&Object(He.d)("bet.BETDealPermissions.unauthorizedStageChange");return!1},Kt=function(e,t,a,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return zt(e,t,a,n,i)},Ht=function(e){return e.has("bet-enforce-deal-stage-restrictions")},Qt=function(e,t,a,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return!Ht(n)||Kt(e,t,a,n,i)},Wt=a("udif"),Jt=a("Ubk/"),Gt=a("rBqy"),Yt=a("2RhA"),Zt=a("lWsH"),Xt=function(e,t){var a,n,i=t.crmObject,s=Object(Gt.f)(e,i),r=t.hubSettingValues.reduce(function(e,t){var a=t.name,n=t.value;e[a]=n;return e},{}),o=t.nextStage,c=t.prevStage,d=function(){return Zt.b};if(o){var l=o.propertyValueRequirements.filter(function(e){return e.propertyValueForObject.definition});a=l.map(function(e){var t=e.propertyName,a=e.isValueRequired;return Object(v.fromJS)({property:t,required:a})});n=o.propertyValueRequirements.reduce(function(e,t){var a=t.propertyValueForObject,n=null!==a.value?a.value:void 0;e[a.name]=Yt.a.fromJS(a.definition);s=Object(F.f)(s,a.name,n);return e},{});var u=Object(Gt.e)(l.map(function(e){return e.propertyValueForObject}));d=function(e){return u[e]||Zt.b}}var b=void 0,p=void 0;if(e===J.DEAL){b=o&&Object(v.Map)(Object.assign({},o,{probability:parseFloat(o.metadata.probability)}));p=c&&Object(v.Map)(Object.assign({},c,{probability:parseFloat(c.metadata.probability)}))}else{b=o&&Object(v.Map)(o);p=c&&Object(v.Map)(c)}return{nextStage:b,prevStage:p,settings:Object(v.Map)(r),stageProperties:Object(v.List)(a),subject:s,subjectProperties:Object(v.Map)(n),getPropertyPermission:d}},$t={id:"4b5b91842444b0683705ffff6942fb65ddcf3d943c6bd2ddc538d539d6485260",kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"StageChange_Query"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"subjectId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Long"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"nextStageId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"prevStageId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hubSettingValues"},arguments:[{kind:"Argument",name:{kind:"Name",value:"names"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"deals::sync_company_lifecyclestage",block:!1}]}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",alias:{kind:"Name",value:"nextStage"},name:{kind:"Name",value:"pipelineStage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"objectType"},value:{kind:"Variable",name:{kind:"Name",value:"objectType"}}},{kind:"Argument",name:{kind:"Name",value:"stageId"},value:{kind:"Variable",name:{kind:"Name",value:"nextStageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"StageChange_Pipeline"}}]}},{kind:"Field",alias:{kind:"Name",value:"prevStage"},name:{kind:"Name",value:"pipelineStage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"objectType"},value:{kind:"Variable",name:{kind:"Name",value:"objectType"}}},{kind:"Argument",name:{kind:"Name",value:"stageId"},value:{kind:"Variable",name:{kind:"Name",value:"prevStageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stageId"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"metadata"}}]}},{kind:"Field",name:{kind:"Name",value:"crmObject"},arguments:[{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"Variable",name:{kind:"Name",value:"objectType"}}},{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"subjectId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Deal"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultProperties"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",name:{kind:"Name",value:"dealname"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",name:{kind:"Name",value:"deal_currency_code"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",name:{kind:"Name",value:"hs_analytics_source_data_1"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",name:{kind:"Name",value:"hs_analytics_source_data_2"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",name:{kind:"Name",value:"pipeline"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Ticket"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultProperties"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subject"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"StageChange_Pipeline"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PipelineStage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stageId"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"metadata"}},{kind:"Field",name:{kind:"Name",value:"propertyValueRequirements"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"propertyName"}},{kind:"Field",name:{kind:"Name",value:"isValueRequired"}},{kind:"Field",name:{kind:"Name",value:"propertyValueForObject"},arguments:[{kind:"Argument",name:{kind:"Name",value:"objectId"},value:{kind:"Variable",name:{kind:"Name",value:"subjectId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}},{kind:"Field",name:{kind:"Name",value:"definition"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"deleted"}},{kind:"Field",name:{kind:"Name",value:"currencyPropertyName"}},{kind:"Field",name:{kind:"Name",value:"textDisplayHint"}},{kind:"Field",name:{kind:"Name",value:"showCurrencySymbol"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"fieldType"}},{kind:"Field",name:{kind:"Name",value:"formField"}},{kind:"Field",name:{kind:"Name",value:"hidden"}},{kind:"Field",name:{kind:"Name",value:"hubspotDefined"}},{kind:"Field",name:{kind:"Name",value:"groupName"}},{kind:"Field",name:{kind:"Name",value:"externalOptions"}},{kind:"Field",name:{kind:"Name",value:"displayOrder"}},{kind:"Field",name:{kind:"Name",value:"displayMode"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"calculated"}},{kind:"Field",name:{kind:"Name",value:"objectTypeId"}},{kind:"Field",name:{kind:"Name",value:"readOnlyDefinition"}},{kind:"Field",name:{kind:"Name",value:"readOnlyValue"}},{kind:"Field",name:{kind:"Name",value:"referencedObjectType"}},{kind:"Field",name:{kind:"Name",value:"numberDisplayHint"}},{kind:"Field",name:{kind:"Name",value:"mutableDefinitionNotDeletable"}},{kind:"Field",name:{kind:"Name",value:"options"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"displayOrder"}},{kind:"Field",name:{kind:"Name",value:"doubleData"}},{kind:"Field",name:{kind:"Name",value:"hidden"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"readOnly"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"permissions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"readOnlyValue"}}]}}]}}]}}]}}]},ea=function(e){return e.filter(fe.a).keySeq().toSet()},ta=function(e){return e&&"object"==typeof e?e instanceof v.Set?e:Array.isArray(e)||e instanceof v.List?Object(v.Set)(e):e instanceof v.Map?ea(e):"object"==typeof e?ea(Object(v.fromJS)(e)):e:Object(v.Set)()},aa=function(e,t){var a=Object(F.d)(t,"amount");Et.b.log("recordUsage",{action:"close deal "+(e?"won":"lost"),what_value:parseInt(a,10),type:J.DEAL})},na=_t()(Lt()(ye()("isValueRequired")),Rt.a),ia=function(e){var t=e.state,a=e.label,n=e.requiredFields;Et.b.logRecordInteraction(J.TICKET,{action:"Changed ticket status",type:t,label:a,count:1,countRequired:na(n)});t===Ft.a&&Et.b.log("ticketsActivation")},sa=function(e,t,a,n,i){return function(s){var r=a.merge(Object(v.Map)(s));i(r);var o=r.keySeq().toArray();Et.b.log("saved-properties",{properties:o.length?o.join(" "):void 0});if(e===J.DEAL&&[0,1].includes(n.get("probability"))){var c=1===n.get("probability");return aa(c,r.reduce(function(e,t,a){return Object(F.f)(e,a,t)},t))}e===J.TICKET&&ia({state:n.getIn(["metadata","ticketState"]),label:n.get("label"),requiredFields:n.get("propertyValueRequirements")||[]});return null}},ra=function(e){var t=e.propertyUpdates,a=e.objectType,n=e.pipelineId,i=e.subject,s=e.scopes,r=e.subjectId,o=e.updater,c=ta(s),d=a===J.DEAL?Object(F.d)(i,"dealstage"):Object(F.d)(i,"hs_pipeline_stage"),l=a===J.DEAL?t.get("dealstage"):t.get("hs_pipeline_stage");return!(a===J.DEAL&&l&&!Qt(n,d,l,c))&&Object(Jt.b)({query:$t,variables:{objectType:a,subjectId:r,prevStageId:d||"",nextStageId:l||""},fetchPolicy:"network-only"}).then(function(e){var n=e.data;if(!e.errors){var r=Xt(a,n),c=r.nextStage,d=r.prevStage,l=r.settings,u=r.stageProperties,b=r.subject,p=r.subjectProperties,m=r.getPropertyPermission;if(!u.isEmpty())return At({getPropertyInputResolver:Ct.a,objectType:a,subject:b,prevStage:d,nextStage:c,prevProperties:b.get("properties"),PropertyInput:Wt.a,nextProperties:t,stageProperties:u,subjectProperties:p,settings:l,getPropertyPermission:m,saveCallback:sa(a,b,t,c,o),cancelCallback:function(){},scopes:s});if(a===J.DEAL&&c){var f=t.has("closedate"),j=c.get("probability")&&+c.get("probability"),v=[0,1].includes(j),k=ye()("probability",d)&&+ye()("probability",d);v&&aa(1===j,t.reduce(function(e,t,a){return Object(F.f)(e,a,t)},i));!f&&v&&k!==j&&(t=t.set("closedate",A.a.moment.userTz().valueOf()))}return o(t)}Ge()})},oa=a("DNdP"),ca=Ue()(function(e,t,a){var i=function(t){Object(b.a)(i,t);function i(){var t;Object(c.a)(this,i);(t=Object(l.a)(this,Object(u.a)(i).call(this))).handleChange=function(e,a,n){var i=n.target.value,s=t.state.draft;Object(F.d)(e,a)===i?t.setState({draft:s.delete(""+Object(F.a)(e)+a)}):t.setState({draft:s.set(""+Object(F.a)(e)+a,{property:a,subject:e,value:i})})};t.handleCancel=function(){t.setState({draft:Object(v.Map)()})};t.updateProperties=function(a,n){var i=t.props,s=i.auth,r=i.sourceApp,o=i.updateProperties,c=n.map(function(e,t){return{name:t,value:e}}).toArray();o({variables:{propertyUpdatesInput:{propertySourceInfo:{propertySource:r,propertySourceId:g()(["user","email"],s)},objectType:e,objectId:parseInt(a,10),properties:c}},update:function(e,a){var n=a.data,i=g()(["updateResponse","userErrors"],n)||[];i.length?i.forEach(Ge):t.setState({draft:Object(v.Map)()})}})};t.handleTracking=function(a){var n={action:"save from sidebar",objectType:e},i=t.state.draft;i.has(Object(F.a)(a)+"hubspot_owner_id")&&(n.action="assign ticket to owner");var s=Object(F.a)(a),r=i&&i.mapKeys(function(e){return e.replace(s,"")});Object(oa.a)(r,n)};t.handleSave=function(){var a=t.props.auth,i=t.state.draft.reduce(function(a,i){var s=i.property,r=i.subject,o=i.value;a[Object(F.a)(r)]?a[Object(F.a)(r)].properties.set(s,o):a[Object(F.a)(r)]={properties:Object(v.Map)(Object(n.a)({},s,o)),subjectId:Object(F.a)(r),subject:r,objectType:e};t.handleTracking(r);return a},{});Ke()(function(n){var i=n.subjectId,s=n.subject,r=n.properties,o=e===J.DEAL?Object(F.d)(s,"pipeline"):Object(F.d)(s,"hs_pipeline");ra({objectType:e,pipelineId:o,propertyUpdates:r,scopes:g()(["user","scopes"],a),subject:s,subjectId:i,updater:Ve()(t.updateProperties,parseInt(i,10))})},i)};t.getDraftProperty=t.getDraftProperty.bind(Object(V.a)(t));t.handleChange=Ue()(t.handleChange);t.state={draft:Object(v.Map)()};return t}Object(d.a)(i,[{key:"getChanges",value:function(){var t=this.state.draft;return t.isEmpty()?null:A.a.text("customerDataSidebar.changeDescriptions."+e,{count:t.count()})}},{key:"getDraftProperty",value:function(e,t){var a=this.state.draft;if(!a.isEmpty()){var n=a.get(""+Object(F.a)(e)+t);return n&&n.value}}},{key:"render",value:function(){return Object(p.jsx)("div",{children:Object(p.jsx)(qe.a,{changes:this.getChanges(),onCancel:this.handleCancel,onSave:this.handleSave,children:Object(p.jsx)(a,Object.assign({},this.props,{getDraftProperty:this.getDraftProperty,changeBuilder:this.handleChange,_rawDraft:this.state.draft}))})})}}]);return i}(j.PureComponent);i.propTypes={auth:f.a.object,sourceApp:f.a.string,updateProperties:f.a.func,tracker:f.a.object};return function(e){var a=Object(Ye.useMutation)(t),n=Object(_e.a)(a,1)[0];return Object(p.jsx)(i,Object.assign({},e,{updateProperties:n}))}}),da=a("4plp"),la=a("cvZm"),ua=a("c50W"),ba=a("a/Fj"),pa=a("eUxV"),ma=Ue()(function(e){function t(t){var a=Object.assign({},t),n=Object(j.useContext)(ba.a).setPreviewConfig,i=Object(j.useCallback)(function(e,t){n(Object(ba.b)({objectTypeId:pa.k[t]||t,objectId:e}))},[n]);return Object(p.jsx)(e,Object.assign({onPreviewRecord:i},a))}t.WrappedComponent=e;t.displayName="ConversationUniversalSidebarCardAdapter"+(e.displayName?"("+e.displayName+")":"");return t}),fa=a("wODV");a.d(t,"DealConversationsContentGqlConfig",function(){return ja});a.d(t,"DealConversationsCardContent",function(){return va});var ja={getGraphQLQueryVariables:function(e){var t=e.conversationId,a=e.objectType,n=e.subjectId;return{conversationId:t,objectType:a,subjectId:parseInt(n,10)}},parse:da.e,query:da.a},va=Object(fa.a)(ma(Object(Nt.a)(Object(n.a)({},ua.hb,la.a),s()(Object(we.a)({toObjectType:J.DEAL,mutation:da.c,countProp:"conversationItemsCount"}),ca(J.DEAL,da.d))(Le))),{gqlConfig:ja,key:"ConversationsDealCard"});t.default=va},dwuz:function(e,t,a){"use strict";a.d(t,"a",function(){return y});var n=a("vTCD"),i=a("k8Et"),s=a("mNyx"),r=a("txVw"),o=a("UMxk"),c=a("pGTB"),d=a("QgEn"),l=a("VfuR"),u=a.n(l),b=a("Ktcs"),p=a("9hyx"),m=a("46u0"),f=a.n(m),j=a("P4dz"),v=a("MO2O"),k=a("leqx"),g=a("tPYf"),O=a("2IJn"),h=a("MQNR"),y=function(e){var t=e.toObjectType,a=e.mutation,l=e.countProp,m=e.updateBuilder,y=e.renderRemoveAssociationModal,S=void 0===y?null:y;return function(e){var y=function(u){Object(c.a)(b,u);function b(){var e;Object(n.a)(this,b);(e=Object(s.a)(this,Object(r.a)(b).call(this))).handleShowModal=function(t){e.setState({isModalOpen:!0,association:t})};e.handleHideModal=function(){e.setState({isModalOpen:!1})};e.handleRemoveConversationAssociation=function(a){var n=a.count,i=a.update,s=a.association,r=e.props,o=r.conversationId,c=r.tracker,d=r.onDisassociationSuccess,l=h.CONVERSATION+"_TO_"+t;return o?e.removeAssociation({variables:{removeAssociationInput:{fromObjectId:o,toObjectId:Object(j.a)(s),associationType:l},conversationId:o,count:n},update:i}).then(function(e){if(!(0!==e.data.deleteCrmObjectAssociation.userErrors.length)){d&&d({association:s,associationType:l,subjectId:o,objectId:Object(j.a)(s),fromObjectType:h.CONVERSATION,toObjectType:t});Object(O.a)(c,{type:h.CONVERSATION})}}):null};e.handleRemoveRecordAssociation=function(a){var n=a.count,i=a.update,s=a.association,r=e.props,o=r.conversationId,c=r.objectType,d=r.subjectId,l=r.tracker,u=r.onDisassociationSuccess,b=c+"_TO_"+t;return e.removeAssociation({variables:{removeAssociationInput:{fromObjectId:d,toObjectId:Object(j.a)(s),associationType:b},conversationId:o,count:n},update:i}).then(function(e){if(!(0!==e.data.deleteCrmObjectAssociation.userErrors.length)){u&&u({association:s,associationType:b,subjectId:d,objectId:Object(j.a)(s),fromObjectType:c,toObjectType:t});Object(O.a)(l,{type:t})}})};e.state={isModalOpen:!1};e.handleRemoveAssociation=e.handleRemoveAssociation.bind(Object(o.a)(e));return e}Object(i.a)(b,[{key:"handleRemoveAssociation",value:function(){var e;l&&(e=this.props[l]);var t={count:e,update:m&&m({objectType:this.props.objectType,subjectId:parseInt(this.props.subjectId,10),conversationId:this.props.conversationId}),association:this.state.association};this.handleHideModal();var a=this.props,n=a.shouldDisassociateConversation,i=[a.shouldDisassociateRecord&&this.handleRemoveRecordAssociation(t),n&&this.handleRemoveConversationAssociation(t)].filter(function(e){return e});return Promise.all(i)}},{key:"renderRemoveAssociationModal",value:function(){if(!this.state.isModalOpen)return null;if(S)return S({associatedObject:this.state.association,onConfirm:this.handleRemoveAssociation,onReject:this.handleHideModal});var e=Object(d.jsx)(f.a,{message:"customerDataSidebar.deleteModal.associatedObjectTitle",options:{associatedObject:Object(j.g)(this.state.association),subject:Object(j.g)(this.props.subject)}}),t=Object(d.jsx)(f.a,{message:"customerDataSidebar.deleteModal.remove"}),a=Object(d.jsx)(f.a,{message:"customerDataSidebar.deleteModal.cancel"});return Object(d.jsx)(v.a,{"data-test-id":"remove-association-modal",confirmLabel:t,onConfirm:this.handleRemoveAssociation,onReject:this.handleHideModal,message:e,rejectLabel:a})}},{key:"render",value:function(){var t=this;return Object(d.jsx)(p.Mutation,{mutation:a,children:function(a){t.removeAssociation=a;return Object(d.jsxs)("div",{children:[Object(d.jsx)(e,Object.assign({},t.props,{onRemoveAssociation:t.handleShowModal})),t.renderRemoveAssociationModal()]})}})}}]);return b}(b.PureComponent);y.propTypes={objectType:k.a,subject:g.a,subjectId:u.a.string,conversationId:u.a.string,tracker:u.a.object,onDisassociationSuccess:u.a.func,shouldDisassociateConversation:u.a.bool,shouldDisassociateRecord:u.a.bool,renderRemoveAssociationModal:u.a.func};y.defaultProps={shouldDisassociateConversation:!1,shouldDisassociateRecord:!0};return y}}}}]);
//# sourceMappingURL=deal-conversations-card-content.js.map