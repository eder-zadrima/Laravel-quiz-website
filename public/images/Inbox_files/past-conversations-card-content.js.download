(window.webpackJsonp=window.webpackJsonp||[]).push([["past-conversations-card-content"],{KAwS:function(e,t,s){"use strict";var n=s("fzi9"),a=s("QgEn"),r=s("Ktcs"),i=s("9f1P"),o=s.n(i),c=s("DqRu"),d=s("9xhK"),u=s("46u0"),l=s.n(u),b=o.a.div.withConfig({displayName:"RetryRequestMessage__ErrorMessageWrapper",componentId:"sc-1v41ns2-0"})(["text-align:center;"]),j=o.a.h5.withConfig({displayName:"RetryRequestMessage__ErrorMessageHeader",componentId:"sc-1v41ns2-1"})(["margin-top:8px;margin-bottom:8px;"]),h=function(e){var t=e.button,s=e.message,i=e.retry,o=e.title,u=Object(r.useState)(!1),h=Object(n.a)(u,2),m=h[0],v=h[1],O=function(){v(!0);i()};return Object(a.jsxs)(b,{children:[Object(a.jsx)(d.a,{name:"errors/general"}),Object(a.jsx)(j,{children:o}),Object(a.jsx)("p",{className:"m-y-1",children:s}),m?Object(a.jsx)(l.a,{className:"m-y-2",message:"conversations-inbox-ui.retryFailedRequest.retryFailedText"}):Object(a.jsx)(c.a,{className:"m-y-2",use:"tertiary",size:"xs",onClick:O,children:t})]})};h.defaultProps={button:Object(a.jsx)(l.a,{message:"conversations-inbox-ui.retryFailedRequest.button"}),message:Object(a.jsx)(l.a,{message:"conversations-inbox-ui.retryFailedRequest.message"}),title:Object(a.jsx)(l.a,{message:"conversations-inbox-ui.retryFailedRequest.title"})};t.a=h},jmwt:function(e,t,s){"use strict";s.r(t);var n=s("vTCD"),a=s("k8Et"),r=s("mNyx"),i=s("txVw"),o=s("pGTB"),c=s("QgEn"),d=s("Ktcs"),u=s("VfuR"),l=s.n(u),b=s("19qb"),j=s("mKxs"),h=s("l52g"),m=s("DqRu"),v=s("46u0"),O=s.n(v),f=s("WLqE"),p=s("BiPx"),x=s("pw7o"),g=s("SV9y"),y=s("VQTc"),C=s("Cftt"),P=s("MQNR"),T=s("GEiH"),I=s("fogE"),M=s("ooqV"),w=s("tiN1"),L=s("v4Xe"),R=s("6Djj"),N=100,q=function(e){var t=e.currentThreadId,s=void 0===t?null:t,n=e.inboxId,a=void 0===n?null:n,r=e.limit,i=void 0===r?N:r,o=e.offsetId,c=void 0===o?null:o,d=e.offsetTimestamp,u=void 0===d?null:d,l=e.threadListId,b=void 0===l?null:l,j=e.threadListType,h=void 0===j?null:j,m=e.vid,v=void 0===m?null:m;return R.a.put("messages/v2/threadlist/related/vid/"+v+"/page",{query:{limit:i,offsetTimestamp:u,offsetId:c,maxPreviewLength:200},data:{inboxId:a,threadListId:b,threadListType:h,vid:v,currentThreadId:s}})},S=s("NFCw"),k=s("/N35"),A=Object(T.a)({requestFn:q,actionTypes:S.a,toRecordFn:function(e){var t=e.pagedResult,s=t.results,n=t.hasMore,a=t.offset,r=e.totalCount;return{pagedResult:{results:s.map(k.b),hasMore:n,offset:a},totalCount:r}},failureMetaActionCreator:function(){return Object(I.a)({isVisibleToUser:!0})}}),F=function(e){var t=e.offsetTimestamp,s=void 0===t?null:t,n=e.offsetId,a=void 0===n?null:n,r=e.threadId,i=e.vid;return function(e,t){var n=Object(L.a)(t()),o=Object(w.a)(t()),c=Object(M.t)(o),d=Object(M.s)(o);e(A({currentThreadId:r,inboxId:n,limit:10,offsetId:a,offsetTimestamp:s,threadListId:d,threadListType:c,vid:i}))}},E=s("KXN9"),U=s("Pda3"),V=s("0Fok"),B=s("WewH"),_=s("4TVJ"),D=s("ZFBm"),K=s("xRd2"),Q=s("ypMi"),z=s("+O8Q"),H=s("eVil"),W=s.n(H),Y=s("QYOI"),G=s("SMcw"),Z=s("Dskb"),J=s("nDpY"),X=s.n(J),$=10,ee=function(e){var t=e.agentIds;return R.a.put("users-search/v1/users-search/app/search",{data:{mustMatchUserIds:t,offset:0,limit:$},query:{portalId:X.a.get()}})},te=W()("first_name"),se=W()("last_name"),ne=W()("user_id"),ae=function(e){return e.results.reduce(function(e,t){return e.set(""+ne(t),Object(Y.Map)(t))},Object(Y.Map)())},re=Object(T.a)({requestFn:ee,actionTypes:Z.a,toRecordFn:ae}),ie=s("omic"),oe=s.n(ie)()(["agents"]),ce=function(e){var t=Object(G.a)({action:re,selector:oe,ids:e,idsTransform:function(e){return{agentIds:e}}});return{agents:t.entries,retryFailed:t.retryFailed}},de=s("HPXA"),ue=s("9f1P"),le=s.n(ue),be=s("+Q4j"),je=s("UxsU"),he=s("WAUT"),me=s("3Yd4"),ve=s("eP/i"),Oe=s("kZyb"),fe=s("fwDr"),pe=s("dd+0"),xe=s.n(pe),ge=s("KcZi"),ye=s.n(ge),Ce=s("aIj/"),Pe=s.n(Ce),Te=s("ErWS"),Ie=s("bGAR"),Me=s("QhRM"),we="chat",Le=s("K4fH");function Re(e){return Object(Le.b)(e?we+"/"+e:we)}var Ne="inbox";function qe(e){return Object(Le.b)(e?Ne+"/"+e:Ne)}var Se=function(){return window.location.pathname.includes(Ne)},ke=function(){return window.location.pathname.includes(we)},Ae=function(e,t){return Se()?qe(e):ke()?Re(e):t?qe(e):Re(e)},Fe=function(e){Object(o.a)(t,e);function t(){Object(n.a)(this,t);return Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}Object(a.a)(t,[{key:"renderMessage",value:function(){var e=this.props.threadListMember,t=Object(k.l)(e),s=Object(k.u)(e);!s&&t&&(s=Object(c.jsx)(O.a,{message:"ConversationsInboxUIAttachments.threadPreviewText"}));return s&&Object(c.jsx)(Ie.a,{children:Object(Ie.b)(s)})}},{key:"renderFileAttachmentIcon",value:function(){var e=this.props.threadListMember;return Object(k.l)(e)?Object(c.jsx)(me.a,{className:"m-right-1",name:"attach"}):null}},{key:"render",value:function(){var e=this.props,t=e.publishFailed,s=e.threadListMember,n="display-inline-flex p-bottom-1 width-100",a=Object(c.jsxs)(Me.a,{className:"flex-row width-100",external:!0,href:Ae(Object(k.B)(s)),children:[this.renderFileAttachmentIcon(),this.renderMessage()]}),r=Object(c.jsxs)(Oe.a,{use:"error",children:[Object(c.jsx)(me.a,{className:"m-right-1",name:"warning",size:"xxs"}),Object(c.jsx)(O.a,{message:"conversations-inbox-ui.alerts.PUBLISH_FAILED.message"})]});return Object(c.jsx)("span",{className:n,children:t?r:a})}}]);return t}(d.Component);Fe.propTypes={publishFailed:l.a.bool.isRequired,threadListMember:Object(j.a)("ThreadListMember").isRequired};Fe.defaultProps={publishFailed:!1};Fe.displayName="PastConversationPreviewMessage";var Ee=Fe;function Ue(){var e=Object(de.a)(["\n            color: ",";\n          "]);Ue=function(){return e};return e}var Ve=function(e){switch(e){case be.LIVE_CHAT:return"messages";case be.FB_MESSENGER:return"socialFacebookMessenger";case be.EMAIL:default:return"email"}},Be=function(e){var t=e.status,s=e.assignedUser;if(e.isLoadingUser)return Object(c.jsx)(Te.a,{width:"100px"});if(!s)return Object(c.jsx)(O.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.assigneeText.unassigned"});var n=Object(c.jsx)(ye.a,{givenName:te(s),familyName:se(s)});return t===je.a.STARTED?Object(c.jsx)(xe.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.assigneeText.assignedTo",options:{assigneeName:n}}):Object(c.jsx)(xe.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.assigneeText.closedBy",options:{assigneeName:n}})},_e=function(e){var t=e.assignedUser,s=e.isLoadingUser,n=e.threadListMember,a=Object(k.A)(n),r=Object(k.z)(n);return Object(c.jsxs)(he.a,{className:"m-bottom-4 p-all-2",children:[Object(c.jsxs)("div",{className:"display-flex align-center m-bottom-1",children:[Object(c.jsx)(Ke,{name:Ve(r)}),Object(c.jsx)(Qe,{children:Object(c.jsx)(Oe.a,{children:Be({status:a,assignedUser:t,isLoadingUser:s})})})]}),Object(c.jsx)("div",{children:Object(c.jsx)(Ee,{threadListMember:n})}),Object(c.jsxs)("div",{style:{color:ve.SLINKY},children:[Object(c.jsx)(Oe.a,{children:Object(c.jsx)(O.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.latestMessageSentAt"})}),Object(c.jsx)(Oe.a,{className:"m-left-1","data-test-vr-hidden":!0,children:Object(c.jsx)(Pe.a,{value:Object(k.p)(n)})})]})]})};_e.displayName="PastConversationTile";_e.propTypes={assignedUser:l.a.instanceOf(Y.Map),isLoadingUser:l.a.bool.isRequired,threadListMember:Object(j.a)("ThreadListMember").isRequired};var De=_e,Ke=le()(me.a).withConfig({displayName:"PastConversationTile___StyledUIIcon",componentId:"v0ily9-0"})(["color:",";margin-right:4px;"],ve.EERIE),Qe=le()(fe.a)(Ue(),ve.SLINKY),ze=function(e){return W()("agentId",Object(k.d)(e))},He=function(e){var t=e.threadListMembers,s=Object(d.useMemo)(function(){return Object(Y.Set)(t.map(ze).filter(function(e){return!!e}))},[t]),n=ce(s).agents;return Object(c.jsx)(d.Fragment,{children:t.map(function(e){var t=ze(e),s=W()(""+t,n),a=Object(E.a)(s);return Object(c.jsx)(De,{assignedUser:t?a:void 0,isLoadingUser:!!t&&Object(U.b)(s),threadListMember:e},Object(k.B)(e))})})};He.propTypes={threadListMembers:l.a.array.isRequired};var We=He,Ye=s("IqVT"),Ge=s("Z6+D"),Ze=Object(Ye.createAction)(Ge.a),Je=s("KAwS");s.d(t,"PastConversationsCardContent",function(){return Xe});var Xe=function(e){return Object(c.jsx)(et,Object.assign({},e),e.vid+"-"+e.currentThreadId)},$e=function(e){Object(o.a)(t,e);function t(){var e,s;Object(n.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];(s=Object(r.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).state={sidePanelOpen:!1};s.fetchPastConversations=function(){s.props.fetchThreadListMembersByVid({vid:s.props.vid,threadId:s.props.currentThreadId})};s.handleLoadMore=function(){var e=s.props,t=e.vid,n=e.currentThreadId,a=e.asyncPastConversations;if(null!==t&&null!==n){var r=Object(B.d)(Object(E.a)(a));r&&r--;s.props.fetchThreadListMembersByVid({vid:t,offsetTimestamp:r,offsetId:Object(B.c)(Object(E.a)(a)),threadId:n})}};s.handleViewAll=function(){Object(_.c)(Object(D.d)({objectType:P.CONVERSATION}));s.setState({sidePanelOpen:!0})};s.handleClosePanel=function(){s.setState({sidePanelOpen:!1})};return s}Object(a.a)(t,[{key:"componentDidMount",value:function(){this.fetchPastConversations()}},{key:"componentWillUnmount",value:function(){this.props.removeStalePastConversations()}},{key:"renderMoreButton",value:function(){var e=this.props.asyncPastConversations;return Object(B.b)(Object(E.a)(e))?Object(c.jsx)(m.a,{use:"link",onClick:this.handleLoadMore,children:Object(c.jsx)(O.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.moreLink"})}):null}},{key:"renderPanelContent",value:function(){var e=this.props.asyncPastConversations,t=Object(B.e)(Object(E.a)(e)).toArray();return Object(c.jsxs)("div",{children:[Object(c.jsx)(We,{threadListMembers:t}),this.renderMoreButton()]})}},{key:"renderCardContent",value:function(){var e=this.props.asyncPastConversations,t=Object(B.e)(Object(E.a)(e));if(Object(U.d)(e)||!t)return Object(c.jsx)(h.a,{grow:!0});if(0===t.size)return Object(c.jsx)(O.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.zeroState"});var s=t.slice(0,3).toArray(),n=t.size>3;return Object(c.jsxs)("div",{children:[Object(c.jsx)(We,{threadListMembers:s}),Object(c.jsx)("div",{className:"text-center",children:n?Object(c.jsx)(m.a,{use:"link",onClick:this.handleViewAll,children:Object(c.jsx)(O.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.viewAll"})}):null})]})}},{key:"renderSidePanel",value:function(){return Object(c.jsxs)(x.a,{width:z.e,children:[Object(c.jsx)(p.a,{onClick:this.handleClosePanel}),Object(c.jsx)(y.a,{children:Object(c.jsx)(f.a,{children:Object(c.jsx)(O.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.otherConversations"})})}),Object(c.jsx)(g.a,{children:Object(c.jsx)(C.a,{children:this.renderPanelContent()})})]})}},{key:"render",value:function(){var e=this.state.sidePanelOpen,t=this.props.asyncPastConversations;return Object(U.f)(t)?Object(c.jsx)(h.a,{grow:!0}):Object(U.a)(t)?Object(c.jsx)(Je.a,{message:Object(c.jsx)(O.a,{message:"conversations-inbox-ui.crm-integration.PastConversationsCard.failed.message"}),retry:this.fetchPastConversations}):Object(c.jsxs)("div",{children:[Object(c.jsx)(K.a,{stepKey:Q.d,header:Object(c.jsx)(O.a,{message:"conversations-inbox-ui.new-feature-onboarding.crmSidebar.otherConversationsCard.header"}),body:Object(c.jsx)(O.a,{message:"conversations-inbox-ui.new-feature-onboarding.crmSidebar.otherConversationsCard.body"}),placement:"left",children:this.renderCardContent()}),e&&this.renderSidePanel()]})}}]);return t}(d.Component);$e.propTypes={asyncPastConversations:Object(j.a)("AsyncData").isRequired,currentThreadId:l.a.string.isRequired,fetchThreadListMembersByVid:l.a.func.isRequired,removeStalePastConversations:l.a.func.isRequired,vid:l.a.number.isRequired};var et=Object(b.connect)(function(e){return{asyncPastConversations:Object(V.a)(e)}},{fetchThreadListMembersByVid:F,removeStalePastConversations:Ze})($e);t.default=Xe}}]);
//# sourceMappingURL=past-conversations-card-content.js.map