var clipboard_str = '';

console.log('ribbon_bar');

// $('#target_element').val('');

// template function
$('#xxxxx').click(function () {
    console.log('xxx');
});


// Copy btn click function
$('#slide_view_copy_btn').click(function () {
    console.log('copy click');
    clipboard_str = get_selected_str();
});

$('#slide_view_copy_btn').mousedown(function (e) {
    e.preventDefault(); // prevent the textarea to loose focus!
});


// cut function
$('#slide_view_cut_btn').click(function () {
    console.log('slide_view_cut_btn');
    clipboard_str = get_selected_str();
    console.log('clipboard_str', clipboard_str);
    delete_selected_str();
});

$('#slide_view_cut_btn').mousedown(function (e) {
    e.preventDefault(); // prevent the textarea to loose focus!
});


// Paste btn click function
$('#slide_view_paste_btn').click(function () {
    console.log('slide_view_paste_btn');
    paste_str(clipboard_str);
    // window.getSelection().removeAllRanges();

	setCurrentCursorPosition(get_cursor_pos_supposed_to_be(clipboard_str));
});

$('#slide_view_paste_btn').mousedown(function (e) {
    e.preventDefault(); // prevent the textarea to loose focus!
});

//  https://raw.githubusercontent.com/Sophie627/flutter-Enriched-Digital-Writer-re-build/master/lib/widget/texteditor/divelement.dart

function get_selected_str() {
    var sel = window.getSelection(); // Gets selection
    if (sel.rangeCount) {
        return (sel.toString());
    }
    return ('');
}

function delete_selected_str() {
    var sel = window.getSelection(); // Gets selection
    if (sel.rangeCount) {
        // Creates a new element, and insert the selected text with the chosen font inside
        var range = sel.getRangeAt(0);
        range.deleteContents(); // Deletes selected text…
    }
}

function paste_str(str) {
    console.log(str);
    var sel = window.getSelection(); // Gets selection
	
    if (sel.rangeCount) {
        // Creates a new element, and insert the selected text with the chosen font inside
        var e = document.createElement('span');
        // e.style = 'font-family:' + font.value + ';';
        e.innerHTML = str;
        var range = sel.getRangeAt(0);
        range.deleteContents(); // Deletes selected text…
        range.insertNode(e); // … and inserts the new element at its place
    }
}

function changeFont(font) {
    var sel = window.getSelection(); // Gets selection
    if (sel.rangeCount) {
        // Creates a new element, and insert the selected text with the chosen font inside
        var e = document.createElement('span');
        e.style = 'font-family:' + font.value + ';';
        e.innerHTML = sel.toString();

        // https://developer.mozilla.org/en-US/docs/Web/API/Selection/getRangeAt
        var range = sel.getRangeAt(0);
        range.deleteContents(); // Deletes selected text…
        range.insertNode(e); // … and inserts the new element at its place
    }
}


<!-- Set cursor in div -->
function createRange(node, chars, range) {
    if (!range) {
        range = document.createRange()
        range.selectNode(node);
        range.setStart(node, 0);
    }

    if (chars.count === 0) {
        range.setEnd(node, chars.count);
    } else if (node && chars.count >0) {
        if (node.nodeType === Node.TEXT_NODE) {
            if (node.textContent.length < chars.count) {
                chars.count -= node.textContent.length;
            } else {
                 range.setEnd(node, chars.count);
                 chars.count = 0;
            }
        } else {
            for (var lp = 0; lp < node.childNodes.length; lp++) {
                range = createRange(node.childNodes[lp], chars, range);

                if (chars.count === 0) {
                   break;
                }
            }
        }
   } 

   return range;
};

function setCurrentCursorPosition(chars) {
	console.log('setCurrentCursorPosition 10');
    if (chars >= 0) {
        var selection = window.getSelection();

        range = createRange(document.getElementsByClassName("slide_view_question_element")[0], { count: chars });

        if (range) {
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }
};


function get_cursor_pos_supposed_to_be(str) {
	var el = document.getElementsByClassName('slide_view_question_element')[0].innerText;
	return(el.indexOf(str) + str.length);
}
